{% if config.google_analytics %}
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ config.google_analytics.0 }}"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', {{ config.google_analytics.0|tojson }});
</script>
{% endif %}
{% if config.matomo %}
<!-- Matomo -->
<script type="text/javascript">
    var _paq = window._paq = window._paq || [];
    var siteID = {{ config.matomo|tojson }};
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['requireCookieConsent']); // Don't use cookies unless we have consent
    _paq.push(['setCookieDomain', '*.threesixtygiving.org']);
    _paq.push(['setDomains', '*.threesixtygiving.org']);
    _paq.push(['setDownloadExtensions', "json|csv|xlsx"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
    var u="https://analytics.threesixtygiving.org/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    if(!siteID) throw new Error("siteID not set");
    _paq.push(['setSiteId', siteID]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<!-- End Matomo Code -->
{% endif %}

<script type="text/javascript">
    function hideCookieConsentDialog(hide){
        if (hide){
        document.getElementsByClassName("cookie-consent")[0].style.display = 'none';
        } else {
        document.getElementsByClassName("cookie-consent")[0].style.display = 'block';
        }
    }

    function noCookieConsent() {
        document.cookie = "noEnhancedAnalytics=1; domain=threesixtygiving.org";
    }

    document.addEventListener('DOMContentLoaded', function(){
        if (document.cookie.indexOf("mtm_cookie_consent") > -1 ||
            document.cookie.indexOf("mtm_consent_removed") > -1 ||
            document.cookie.indexOf("noEnhancedAnalytics") > -1) {
        hideCookieConsentDialog(true);
        } else {
        hideCookieConsentDialog(false);
        }
    });
</script>